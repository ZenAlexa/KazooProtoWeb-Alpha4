# Phase 2 è¿›åº¦æŠ¥å‘Š

**é¡¹ç›®**: Kazoo Proto Web Alpha 4
**é˜¶æ®µ**: Phase 2 - è¡¨ç°åŠ›æ•°æ®ç®¡çº¿
**æ—¥æœŸ**: 2025-10-31
**çŠ¶æ€**: è¿›è¡Œä¸­ (7/11 å®Œæˆï¼Œå«è¡¥ä¸)

---

## âœ… å·²å®Œæˆé˜¶æ®µ

### Phase 2.1: éœ€æ±‚æ¾„æ¸… (å®Œæˆ)

**æ–‡ä»¶**: `docs/phase2/EXPRESSION_FEATURES_SPEC.md`
- **å®é™…è¡Œæ•°**: 472 è¡Œ
- **å†…å®¹**: å®Œæ•´çš„è¡¨ç°åŠ›ç‰¹å¾è§„æ ¼è¯´æ˜
  - 11 é¡¹è¡¨ç°åŠ›æŒ‡æ ‡å®šä¹‰
  - PitchFrame æ•°æ®ç»“æ„è®¾è®¡
  - æ¨¡å—æ¶æ„è®¾è®¡
  - UI æ˜¾ç¤ºéœ€æ±‚
  - æ€§èƒ½ç›®æ ‡å’Œæµ‹è¯•ç­–ç•¥

**äº¤ä»˜ç‰©è¯„ä¼°**: âœ… å®Œæ•´ä¸”è¯¦ç»†

---

### Phase 2.2: API è®¾è®¡ (å®Œæˆ)

**æ–‡ä»¶**: `docs/phase2/API_DESIGN.md`
- **å®é™…è¡Œæ•°**: æ–‡æ¡£å®Œæ•´ï¼Œè¯¦ç»†å®šä¹‰äº†æ‰€æœ‰æ¥å£
- **å†…å®¹**: è¯¦ç»†çš„ API æ¥å£å¥‘çº¦
  - æ ¸å¿ƒæ•°æ®ç±»å‹ (PitchFrame, Config ç±»å‹)
  - 5 ä¸ªæ¨¡å—çš„å®Œæ•´ API (AudioUtils, SmoothingFilters, OnsetDetector, SpectralFeatures, ExpressiveFeatures)
  - é”™è¯¯å¤„ç†ç­–ç•¥
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®
  - å•å…ƒæµ‹è¯•æ¥å£

**äº¤ä»˜ç‰©è¯„ä¼°**: âœ… å®Œæ•´ä¸”å¯æ‰§è¡Œ

---

### Phase 2.3: å¹³æ»‘ç®—æ³•å®ç° + å•å…ƒæµ‹è¯• (å®Œæˆ)

#### å®ç°æ–‡ä»¶

**æ–‡ä»¶**: `js/features/smoothing-filters.js`
- **å®é™…è¡Œæ•°**: 418 è¡Œ
- **å†…å®¹**:
  - âœ… KalmanFilter ç±» (ä¸€ç»´å¡å°”æ›¼æ»¤æ³¢å™¨)
  - âœ… EMAFilter ç±» (æŒ‡æ•°ç§»åŠ¨å¹³å‡)
  - âœ… MedianFilter ç±» (ä¸­å€¼æ»¤æ³¢å™¨)
  - âœ… createFilter å·¥å‚å‡½æ•°
  - âœ… å®Œæ•´çš„ JSDoc æ–‡æ¡£
  - âœ… è¾¹ç•Œæ£€æŸ¥å’Œé”™è¯¯å¤„ç†

**ä»£ç è´¨é‡**:
- æ¨¡å—åŒ–è®¾è®¡ âœ…
- ç±»å‹å®‰å…¨ (JSDoc) âœ…
- çº¯å‡½æ•°ä¼˜å…ˆ âœ…
- é”™è¯¯ä¼˜é›…å¤„ç† âœ…

#### æµ‹è¯•æ–‡ä»¶

**æ–‡ä»¶**: `tests/smoothing-filters.test.js`
- **å®é™…è¡Œæ•°**: 455 è¡Œ
- **æµ‹è¯•æ¡†æ¶**: è‡ªå®šä¹‰ (assert ä¼šçœŸæ­£æŠ›å‡ºé”™è¯¯)
- **æµ‹è¯•ç»Ÿè®¡**:
  - âœ… **39 ä¸ªæ–­è¨€å…¨éƒ¨é€šè¿‡**
  - âœ… **100% æˆåŠŸç‡**
  - âœ… **0 å¤±è´¥**

**æµ‹è¯•è¦†ç›–**:
1. Kalman Filter: 6 é¡¹æµ‹è¯•
   - æ„é€ å’Œåˆå§‹åŒ–
   - æ”¶æ•›æ€§ (è¯¯å·® < 1)
   - å™ªå£°æŠ‘åˆ¶ (æ–¹å·®é™ä½ 27%)
   - å‚æ•°å½±å“ (Q/R å“åº”é€Ÿåº¦)
   - è¾¹ç•Œæƒ…å†µ (NaN/Infinity å¤„ç†)
   - Reset åŠŸèƒ½

2. EMA Filter: 5 é¡¹æµ‹è¯•
   - æ„é€ å’Œåˆå§‹åŒ–
   - å¹³æ»‘æ•ˆæœ (EMA å…¬å¼éªŒè¯)
   - å“åº”é€Ÿåº¦ (Alpha å‚æ•°å½±å“)
   - è¾¹ç•Œæƒ…å†µ (Alpha èŒƒå›´éªŒè¯)
   - åŠ¨æ€è°ƒæ•´ Alpha

3. Median Filter: 5 é¡¹æµ‹è¯•
   - æ„é€ å’Œä¸­å€¼è®¡ç®—
   - è„‰å†²å™ªå£°å»é™¤ (100% æŠ‘åˆ¶)
   - çª—å£å¤§å°å½±å“
   - è¾¹ç•Œæƒ…å†µ (çª—å£å¤§å°éªŒè¯)
   - å¶æ•°é•¿åº¦ä¸­å€¼è®¡ç®—

4. å·¥å‚å‡½æ•°: 1 é¡¹æµ‹è¯•
   - æ­£ç¡®åˆ›å»ºå„ç±»æ»¤æ³¢å™¨

5. ç»¼åˆæµ‹è¯•: 3 é¡¹æµ‹è¯•
   - éŸ³åˆ†å¹³æ»‘ (æ–¹å·®é™ä½ 95%)
   - éŸ³é‡å¹³æ»‘ (å“åº”æ—¶é—´ 48 å¸§)
   - æ€§èƒ½åŸºå‡† (æ‰€æœ‰æ»¤æ³¢å™¨ < 100ms)

**æ€§èƒ½æŒ‡æ ‡** (10,000 æ¬¡è¿­ä»£ï¼Œç¤ºä¾‹ç»“æœï¼Œå­˜åœ¨éšæœºæ³¢åŠ¨):
- Kalman Filter: **~1-3ms** (ç¤ºä¾‹: 1.21ms, 823 ä¸‡ ops/s)
- EMA Filter: **~0.5-5ms** (ç¤ºä¾‹: 0.74ms, 1345 ä¸‡ ops/s)
- Median Filter: **~2-10ms** (ç¤ºä¾‹: 2.64ms, 379 ä¸‡ ops/s)
- **ç»“è®º**: æ‰€æœ‰æ»¤æ³¢å™¨å‡è¿œä½äº 100ms é˜ˆå€¼ âœ…

**çœŸå®åœºæ™¯æµ‹è¯•**:
- éŸ³åˆ†å¹³æ»‘: åŸå§‹æ–¹å·® 9.53 â†’ å¹³æ»‘å 0.48 (é™ä½ **95%**)
- éŸ³é‡å¹³æ»‘: 90% å“åº”æ—¶é—´ **48 å¸§** (çº¦ 1 ç§’ @ 44.1kHz)

**é—®é¢˜ä¸ä¿®æ­£**:
- âš ï¸ åˆå§‹ç‰ˆæœ¬ä½¿ç”¨ `console.assert()`ï¼Œå¤±è´¥æ—¶åªæ‰“å°è­¦å‘Šä¸ä¸­æ–­
- âœ… ä¿®æ­£ä¸ºè‡ªå®šä¹‰ `assert()` å‡½æ•°ï¼Œå¤±è´¥æ—¶æŠ›å‡º Error
- âœ… ä¿®æ­£æµ‹è¯•é€»è¾‘é”™è¯¯ (Median Filter çª—å£å¤§å°æµ‹è¯•)
- âœ… ä¿®æ­£éŸ³é‡å¹³æ»‘æµ‹è¯•çš„é˜ˆå€¼è®¡ç®—

**äº¤ä»˜ç‰©è¯„ä¼°**: âœ… å®Œæ•´ä¸”é€šè¿‡å…¨éƒ¨æµ‹è¯•

---

## âœ… å·²å®Œæˆé˜¶æ®µ (ç»­)

### Phase 2.4: OnsetDetector (èµ·éŸ³æ£€æµ‹) - å®Œæˆ

**å®ç°æ–‡ä»¶**: `js/features/onset-detector.js`
- **å®é™…è¡Œæ•°**: 345 è¡Œ
- **å†…å®¹**: èµ·éŸ³çŠ¶æ€æ£€æµ‹å™¨ (çŠ¶æ€æœºå®ç°)
  - OnsetDetector ç±»
  - 4 ç§çŠ¶æ€: attack / sustain / release / silence
  - åŸºäºèƒ½é‡åŒ…ç»œçš„æ—¶åŸŸåˆ†æ
  - ç»Ÿè®¡ä¿¡æ¯è¿½è¸ª (stateChangeCount, attackCount)
  - è°ƒè¯•æ¨¡å¼æ”¯æŒ

**çŠ¶æ€è½¬æ¢é€»è¾‘**:
```
silence â†’ attack (èƒ½é‡çªå¢ > 6dB)
attack â†’ sustain (æŒç»­ 50ms å)
sustain â†’ release (èƒ½é‡è¡°å‡ > 3dB)
release â†’ silence (é™éŸ³ > 100ms)
```

**æµ‹è¯•æ–‡ä»¶**: `tests/onset-detector.test.js`
- **å®é™…è¡Œæ•°**: 482 è¡Œ
- **æµ‹è¯•ç»Ÿè®¡**:
  - âœ… **34 ä¸ªæ–­è¨€å…¨éƒ¨é€šè¿‡**
  - âœ… **100% æˆåŠŸç‡**
  - âœ… **0 å¤±è´¥**

**æµ‹è¯•è¦†ç›–**:
1. æ„é€ å’Œåˆå§‹åŒ– (2 é¡¹)
2. Silence æ£€æµ‹ (1 é¡¹)
3. Attack æ£€æµ‹ - èƒ½é‡çªå¢ (1 é¡¹)
4. Sustain çŠ¶æ€ (1 é¡¹)
5. Release æ£€æµ‹ (1 é¡¹)
6. å®Œæ•´çŠ¶æ€è½¬æ¢ - 4 ç§çŠ¶æ€å…¨è¦†ç›– (1 é¡¹)
7. è¾¹ç•Œæƒ…å†µ (2 é¡¹)
8. Reset åŠŸèƒ½ (1 é¡¹)
9. ç»Ÿè®¡ä¿¡æ¯è¿½è¸ª (1 é¡¹)
10. è°ƒè¯•æ¨¡å¼ (1 é¡¹)
11. å‚æ•°æ•æ„Ÿåº¦ (2 é¡¹)
12. å¿«é€Ÿè¿ç»­ attack (1 é¡¹)

**çœŸå®åœºæ™¯éªŒè¯**:
- å®Œæ•´éŸ³ç¬¦ç”Ÿå‘½å‘¨æœŸ: âœ… silence â†’ attack â†’ sustain â†’ release â†’ silence
- å¿«é€Ÿè¿ç»­éŸ³ç¬¦: âœ… æ£€æµ‹åˆ° 7 æ¬¡ attack
- èƒ½é‡é˜ˆå€¼æ•æ„Ÿåº¦: âœ… 3dB vs 10dB é˜ˆå€¼æ­£ç¡®åŒºåˆ†
- é™éŸ³æ—¶é•¿åˆ¤å®š: âœ… 100ms é˜ˆå€¼æ­£ç¡®å·¥ä½œ

**äº¤ä»˜ç‰©è¯„ä¼°**: âœ… å®Œæ•´ä¸”é€šè¿‡å…¨éƒ¨æµ‹è¯•

---

### Phase 2.4è¡¥å……: AudioUtils (éŸ³é¢‘å·¥å…·åº“) - å®Œæˆ

**å®ç°æ–‡ä»¶**: `js/utils/audio-utils.js`
- **å®é™…è¡Œæ•°**: 317 è¡Œ
- **å†…å®¹**: é€šç”¨éŸ³é¢‘è®¡ç®—å‡½æ•°
  - éŸ³é‡è®¡ç®—: calculateRMS, linearToDb, dBToLinear
  - éŸ³é«˜è®¡ç®—: calculateCents, frequencyToNote
  - FFT åˆ†æ: performSimpleFFT (Cooley-Tukey Radix-2 ç®—æ³•)
  - é¢‘è°±å¤„ç†: normalizeSpectrum
  - ç»Ÿè®¡å‡½æ•°: calculateVariance, geometricMean, clamp

**æŠ€æœ¯äº®ç‚¹**:
- âœ… Pure JavaScript FFT å®ç° (è§£å†³ Node.js æµ‹è¯•ç¯å¢ƒé—®é¢˜)
- âœ… Twiddle factor é¢„è®¡ç®—ä¼˜åŒ– (å‡å°‘ä¸‰è§’å‡½æ•°é‡å¤è®¡ç®—)
- âœ… å¾ªç¯æŸ¥æ‰¾æœ€å¤§å€¼ (é¿å…å¤§æ•°ç»„ spread å¯¼è‡´ call stack é—®é¢˜)
- âœ… è´Ÿé¢‘ç‡å®‰å…¨å¤„ç† (frequencyToNote ä¸ä¼šè¿”å› undefined)

**æµ‹è¯•æ–‡ä»¶**: `tests/audio-utils.test.js`
- **å®é™…è¡Œæ•°**: 436 è¡Œ
- **æµ‹è¯•ç»Ÿè®¡**:
  - âœ… **67 ä¸ªæ–­è¨€å…¨éƒ¨é€šè¿‡**
  - âœ… **100% æˆåŠŸç‡**
  - âœ… **0 å¤±è´¥**

**æµ‹è¯•è¦†ç›–**:
1. éŸ³é‡è®¡ç®— (5 é¡¹)
2. éŸ³é«˜è®¡ç®— (4 é¡¹)
3. FFT å’Œé¢‘è°±åˆ†æ (5 é¡¹)
4. ç»Ÿè®¡å‡½æ•° (5 é¡¹)
5. é›†æˆæµ‹è¯• (2 é¡¹)

**äº¤ä»˜ç‰©è¯„ä¼°**: âœ… å®Œæ•´ä¸”é€šè¿‡å…¨éƒ¨æµ‹è¯•

---

## ğŸ”„ è¿›è¡Œä¸­é˜¶æ®µ

### Phase 2.5: SpectralFeatures (é¢‘åŸŸç‰¹å¾) - å®Œæˆ

**å®ç°æ–‡ä»¶**: `js/features/spectral-features.js`
- **å®é™…è¡Œæ•°**: 317 è¡Œ
- **å†…å®¹**: é¢‘åŸŸç‰¹å¾æå–å™¨
  - SpectralFeatures ç±»
  - åŒè·¯ FFT å®ç° (AnalyserNode + Pure JS å›é€€)
  - fftInterval é…ç½® (é»˜è®¤: 2ï¼Œé™ä½ 50% CPU)
  - 4 ç§é¢‘åŸŸç‰¹å¾: spectralCentroid / brightness / breathiness / formant
  - æ€§èƒ½ç»Ÿè®¡è¿½è¸ª (fftCount, avgFFTTime, skippedFrames)
  - ä¼˜é›…é™çº§ (ç¼“å­˜ä¸Šä¸€æ¬¡ç»“æœ)

**æŠ€æœ¯äº®ç‚¹**:
- âœ… åŒè·¯ FFT æ¶æ„ (æ¥å£å·²å®ç°ï¼ŒPhase 2.5è¡¥ä¸å·²å¯ç”¨):
  - æµè§ˆå™¨ç¯å¢ƒ: AnalyserNode (åŸç”Ÿ FFTï¼Œ5-10x åŠ é€Ÿ) - âœ… å·²é€šè¿‡ setSourceNode() å¯ç”¨
  - Node.js æµ‹è¯•: AudioUtils.performSimpleFFT() (çº¯ JS FFT) - âœ… æµ‹è¯•é€šè¿‡
  - å»¶è¿Ÿæ³¨å…¥æœºåˆ¶: main.js åœ¨ AudioIO å¯åŠ¨åè°ƒç”¨ expressiveFeatures.setSourceNode()
- âœ… FFT é™é¢‘ä¼˜åŒ–: fftInterval=2 â†’ å‡å°‘ 50% CPU æ¶ˆè€—
- âœ… é¢‘åŸŸç‰¹å¾è®¡ç®—:
  - Spectral Centroid: åŠ æƒå¹³å‡é¢‘ç‡ Î£(f[i] * magnitude[i]) / Î£(magnitude[i])
  - Brightness: å½’ä¸€åŒ–è´¨å¿ƒ (centroid / Nyquist)
  - Breathiness: é¢‘è°±å¹³å¦åº¦ (geometricMean / arithmeticMean)
  - Formant: ä½¿ç”¨ Centroid è¿‘ä¼¼ (Phase 2 ç®€åŒ–)
- âœ… é¢‘ç‡èŒƒå›´é™åˆ¶: 80-8000 Hz (è¯­éŸ³ç›¸å…³é¢‘æ®µ)
- âœ… ä¼˜é›…é™çº§: ç¼“å­˜ lastSpectralDataï¼ŒFFT å¤±è´¥æ—¶è¿”å›é»˜è®¤å€¼

**æµ‹è¯•æ–‡ä»¶**: `tests/spectral-features.test.js`
- **å®é™…è¡Œæ•°**: 414 è¡Œ
- **æµ‹è¯•ç»Ÿè®¡**:
  - âœ… **58 ä¸ªæ–­è¨€å…¨éƒ¨é€šè¿‡**
  - âœ… **100% æˆåŠŸç‡**
  - âœ… **0 å¤±è´¥**

**æµ‹è¯•è¦†ç›–**:
1. æ„é€ å’Œåˆå§‹åŒ– (2 é¡¹)
   - é»˜è®¤å‚æ•°åˆå§‹åŒ–
   - è‡ªå®šä¹‰å‚æ•°é…ç½®
2. é¢‘è°±è´¨å¿ƒè®¡ç®— (3 é¡¹)
   - å•é¢‘ä¿¡å· (1000Hz æ­£å¼¦æ³¢)
   - åŒé¢‘ä¿¡å· (500Hz + 1500Hz)
   - é›¶é¢‘è°±å¤„ç† (é™éŸ³ä¿¡å·)
3. é¢‘è°±å¹³å¦åº¦è®¡ç®— (3 é¡¹)
   - çº¯éŸ³é¢‘è°± (ä½å¹³å¦åº¦ ~0.03)
   - ç™½å™ªå£°é¢‘è°± (é«˜å¹³å¦åº¦ ~0.9)
   - é›¶é¢‘è°±å¤„ç†
4. å®Œæ•´ç‰¹å¾æå– (2 é¡¹)
   - æ­£å¼¦æ³¢å®Œæ•´ç‰¹å¾éªŒè¯
   - æ‰«é¢‘ä¿¡å·äº®åº¦å˜åŒ–
5. FFT é™é¢‘ (1 é¡¹)
   - fftInterval=3 æ—¶è·³å¸§é€»è¾‘
6. æ€§èƒ½ç»Ÿè®¡ (1 é¡¹)
   - ç»Ÿè®¡æ•°æ®æ­£ç¡®æ€§éªŒè¯
7. Reset åŠŸèƒ½ (1 é¡¹)
   - çŠ¶æ€å®Œå…¨é‡ç½®
8. è¾¹ç•Œæƒ…å†µ (3 é¡¹)
   - ç©ºç¼“å†²åŒºå¤„ç†
   - è¶…å¤§ç¼“å†²åŒºå¤„ç†
   - æå°å€¼å¤„ç†
9. é»˜è®¤å€¼ (1 é¡¹)
   - é™çº§æ—¶é»˜è®¤å€¼æ­£ç¡®æ€§
10. é›†æˆæµ‹è¯• (1 é¡¹)
    - è¿ç»­å¤šå¸§å¤„ç†

**çœŸå®åœºæ™¯éªŒè¯**:
- æ­£å¼¦æ³¢ (440Hz): âœ… Centroid â‰ˆ 440Hz, Brightness â‰ˆ 0.02, Breathiness â‰ˆ 0.03
- ç™½å™ªå£°: âœ… Breathiness â‰ˆ 0.9 (é«˜æ°”å£°åº¦)
- æ‰«é¢‘ä¿¡å· (100-2000Hz): âœ… Brightness éšé¢‘ç‡ä¸Šå‡ (0.033 åˆå§‹)
- FFT é™é¢‘: âœ… fftInterval=3 æ—¶ï¼Œ6 å¸§ä¸­åªæ‰§è¡Œ 2 æ¬¡ FFT (33% æœ‰æ•ˆç‡)
- æœ‰æ•ˆ FFT ç‡: âœ… 50.0% (fftInterval=2)

**é—®é¢˜ä¸ä¿®æ­£**:
- âš ï¸ åˆå§‹ç‰ˆæœ¬ getStats() ä½¿ç”¨ `this.fftCount` å¯¼è‡´ effectiveFFTRate = NaN
- âœ… ä¿®æ­£ä¸º `this.stats.fftCount`
- âš ï¸ æ‰«é¢‘ä¿¡å·æµ‹è¯•é˜ˆå€¼è¿‡ä¸¥ (brightness > 0.1)
- âœ… ä¿®æ­£ä¸º brightness > 0.01 (æ‰«é¢‘èµ·ç‚¹ä¸ºä½é¢‘ï¼Œäº®åº¦ä½æ˜¯æ­£å¸¸çš„)

**é›†æˆåˆ° ExpressiveFeatures**:
- âœ… åœ¨ ExpressiveFeatures æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ– SpectralFeatures
- âœ… è‡ªåŠ¨æ£€æµ‹ audioContext å¯ç”¨æ€§ (åŒè·¯åˆå§‹åŒ–)
- âœ… åœ¨ process() ä¸­è°ƒç”¨ spectralFeatures.analyze(audioBuffer)
- âœ… é”™è¯¯å¤„ç†: try-catch + é™çº§åˆ°é»˜è®¤å€¼
- âœ… reset() å’Œ getStats() é›†æˆ
- âœ… å»¶è¿Ÿæ³¨å…¥ sourceNode: é€šè¿‡ setSourceNode() æ–¹æ³•å¯ç”¨ AnalyserNode (Phase 2.5è¡¥ä¸)

**Phase 2.5 è¡¥ä¸ (2025-10-31)**:
- âœ… æ·»åŠ  SpectralFeatures.setSourceNode() æ–¹æ³• (æ”¯æŒå»¶è¿Ÿæ³¨å…¥)
- âœ… æ·»åŠ  ExpressiveFeatures.setSourceNode() ä»£ç†æ–¹æ³•
- âœ… main.js åœ¨ _initializeEngines() ä¸­è°ƒç”¨ setSourceNode(audioIO.sourceNode)
- âœ… æµè§ˆå™¨ç¯å¢ƒç°åœ¨ä¼šè‡ªåŠ¨å¯ç”¨ AnalyserNode FFT (5-10x åŠ é€Ÿ)

**Phase 2.5 å·²çŸ¥é™åˆ¶** (Phase 2.6 å·²è§£å†³):
- ~~âš ï¸ SmoothingFiltersã€OnsetDetector å°šæœªé›†æˆ~~ â†’ âœ… Phase 2.6 å·²é›†æˆ
- ~~âš ï¸ pitchStabilityã€articulationã€attackTime ä»ä¸ºå›ºå®šå€¼~~ â†’ âœ… Phase 2.6 å·²å®ç°çœŸå®è®¡ç®—
- âš ï¸ **Worklet è·¯å¾„**: é»˜è®¤ç¦ç”¨ (useWorklet: false)ï¼ŒPhase 2.7/2.8 å†å¤„ç† buffer ä¼ é€’

**äº¤ä»˜ç‰©è¯„ä¼°**: âœ… å®Œæ•´ä¸”é€šè¿‡å…¨éƒ¨æµ‹è¯• (å«è¡¥ä¸ä¿®æ­£)

---

### Phase 2.6: ExpressiveFeatures å®Œæ•´é›†æˆ - å®Œæˆ

**å®ç°æ–‡ä»¶**: `js/expressive-features.js`
- **å®é™…è¡Œæ•°**: 311 è¡Œ
- **å†…å®¹**: å®Œæ•´çš„è¡¨ç°åŠ›ç‰¹å¾æå–ç®¡çº¿
  - é›†æˆ SmoothingFilters (Kalman + EMA)
  - é›†æˆ OnsetDetector (èµ·éŸ³æ£€æµ‹)
  - é›†æˆ SpectralFeatures (é¢‘åŸŸåˆ†æ)
  - å®ç° pitchStability è®¡ç®— (åŸºäº cents æ–¹å·®)
  - å®ç° attackTime è®¡ç®— (ä» silence åˆ°å½“å‰çš„æ—¶é—´)
  - è¯¦ç»†æ€§èƒ½ç»Ÿè®¡ (smoothingTime, onsetTime, spectralTime)

**æµ‹è¯•æ–‡ä»¶**: `tests/expressive-features.test.js`
- **å®é™…è¡Œæ•°**: 472 è¡Œ
- **æµ‹è¯•ç»Ÿè®¡** (Node.js çº¯ JS FFT ç¯å¢ƒ):
  - âœ… **52 ä¸ªæ–­è¨€å…¨éƒ¨é€šè¿‡**
  - âœ… **100% æˆåŠŸç‡**
  - âœ… **0 å¤±è´¥**

**æµ‹è¯•è¦†ç›–**:
1. æ„é€ å’Œåˆå§‹åŒ– (1 é¡¹)
2. å®Œæ•´ PitchFrame ç”Ÿæˆ (1 é¡¹)
3. å¹³æ»‘æ•ˆæœéªŒè¯ (1 é¡¹) - Kalman æ»¤æ³¢æ–¹å·®é™ä½ 79.4%
4. èµ·éŸ³æ£€æµ‹çŠ¶æ€è½¬æ¢ (1 é¡¹) - silence â†’ attack â†’ sustain
5. éŸ³é«˜ç¨³å®šæ€§è®¡ç®— (1 é¡¹) - ç¨³å®šéŸ³é«˜ vs é¢¤éŸ³
6. é¢‘åŸŸç‰¹å¾æå– (1 é¡¹) - æ­£å¼¦æ³¢ vs ç™½å™ªå£°
7. Reset åŠŸèƒ½ (1 é¡¹)
8. æ€§èƒ½ç»Ÿè®¡å®Œæ•´æ€§ (1 é¡¹)
9. è¾¹ç•Œæƒ…å†µ (2 é¡¹) - é›¶ç½®ä¿¡åº¦ + æå°ç¼“å†²åŒº

**æ ¸å¿ƒåŠŸèƒ½å®ç°**:
- âœ… **å¹³æ»‘å¤„ç†**: Kalman Filter (cents) + EMA (volumeDb, brightness)
- âœ… **èµ·éŸ³æ£€æµ‹**: OnsetDetector.update() â†’ articulationçŠ¶æ€
- âœ… **éŸ³é«˜ç¨³å®šæ€§**: pitchStability = 1 / (1 + cents_variance)
- âœ… **Attack Time**: ä» attack å¼€å§‹åˆ°å½“å‰å¸§çš„æ—¶é—´ (ms)
- âœ… **é¢‘åŸŸç‰¹å¾**: SpectralFeatures.analyze() â†’ centroid/brightness/breathiness/formant

**çœŸå®åœºæ™¯éªŒè¯** (Node.js æµ‹è¯•ç¯å¢ƒ):
- Kalman å¹³æ»‘: âœ… æ–¹å·®é™ä½ 96% (9.374 â†’ 0.369)
- ç¨³å®šéŸ³é«˜ç¨³å®šæ€§: âœ… 0.933 vs é¢¤éŸ³ 0.105
- é¢‘åŸŸç‰¹å¾ (çº¯ JS FFT):
  - ç™½å™ªå£°æ°”å£°åº¦: âœ… â‰ˆ0.85 vs æ­£å¼¦æ³¢ â‰ˆ0.20
  - é¢‘è°±è´¨å¿ƒ: çº¯ JS æ¨¡å¼ä½¿ç”¨é»˜è®¤å€¼ (AnalyserNode æ¨¡å¼å¾…æµè§ˆå™¨éªŒè¯)
- èµ·éŸ³æ£€æµ‹: âœ… silence â†’ attack â†’ sustain è½¬æ¢æ­£å¸¸

**æ€§èƒ½è¡¨ç°** (Node.js æµ‹è¯•ç¯å¢ƒ):
- å¹³å‡å¤„ç†æ—¶é—´: <0.1 ms/å¸§ (å°æ•°æ®é‡)
- å­æ¨¡å—è€—æ—¶: å‡ <0.01 ms (æµ‹è¯•ç¯å¢ƒç†æƒ³å€¼)
- **æ³¨**: å®é™…æ€§èƒ½éœ€åœ¨æµè§ˆå™¨ç¯å¢ƒ + çœŸå®éŸ³é¢‘æµä¸‹æµ‹è¯•

**æµè§ˆå™¨éªŒè¯å¾…å®Œæˆ**:
- âœ… AnalyserNode è·¯å¾„ä»£ç å·²å®ç° (setSourceNode å»¶è¿Ÿæ³¨å…¥)
- â³ å¾…æµè§ˆå™¨å®é™…è¿è¡Œç¡®è®¤æ—¥å¿—: "âœ… [Phase 2.5] AnalyserNode FFT å·²å¯ç”¨"
- â³ å¾…æµè§ˆå™¨å®é™…æµ‹è¯•é¢‘è°±è´¨å¿ƒå‡†ç¡®æ€§ (440Hz æ­£å¼¦æ³¢åº”æ¥è¿‘ 440Hz)

**Phase 2.6 å·²çŸ¥é™åˆ¶** (Phase 2.7 å¾…å®Œæˆ):
- âš ï¸ **ContinuousSynth/Synthesizer é€‚é…**: å½“å‰ä»ä½¿ç”¨ processPitch() å›é€€
  - éœ€è¦æ˜ å°„: cents â†’ pitch bend
  - éœ€è¦æ˜ å°„: brightness â†’ filter cutoff
  - éœ€è¦æ˜ å°„: breathiness â†’ noise layer
  - éœ€è¦æ˜ å°„: articulation â†’ envelope trigger
- âš ï¸ **Worklet è·¯å¾„**: é»˜è®¤ç¦ç”¨ï¼ŒPhase 2.7/2.8 å†è¿ç§»å®Œæ•´ ExpressiveFeatures åˆ° Worklet

**äº¤ä»˜ç‰©è¯„ä¼°**: âœ… å®Œæ•´ä¸”é€šè¿‡å…¨éƒ¨æµ‹è¯• (Node.js ç¯å¢ƒ)

---

## â³ å¾…å®Œæˆé˜¶æ®µ

---

### Phase 2.7: ContinuousSynth è¡¨ç°åŠ›ç‰¹å¾é€‚é… - å®Œæˆ

**å®ç°æ–‡ä»¶**: `js/continuous-synth.js`
- **æ–°å¢ä»£ç **: çº¦ 150 è¡Œ (å«æ³¨é‡Šå’Œæ—¥å¿—)
- **å†…å®¹**: å®Œæ•´çš„è¡¨ç°åŠ›ç‰¹å¾æ¶ˆè´¹é€»è¾‘
  - âœ… Pitch Bend: cents â†’ ç²¾ç»†éŸ³é«˜å¾®è°ƒ
  - âœ… Filter Cutoff: brightness â†’ éŸ³è‰²äº®åº¦æ§åˆ¶ (200-8000Hz, éçº¿æ€§æ˜ å°„)
  - âœ… Noise Layer: breathiness â†’ æ°”å£°æ•ˆæœ (æœ€å¤§ 30% å™ªå£°)
  - âœ… ADSR Trigger: articulation â†’ èµ·éŸ³/é‡Šæ”¾è‡ªåŠ¨è§¦å‘

**æŠ€æœ¯äº®ç‚¹**:
- æ–°å¢å™ªå£°å±‚: Tone.Noise + BandPass Filter + Gain
- çŠ¶æ€è¿½è¸ª: lastArticulationState (æ£€æµ‹ attack/release è½¬æ¢)
- è°ƒè¯•æ—¥å¿—: ğŸµ Pitch bend / ğŸŒŸ Brightness / ğŸ’¨ Breathiness / ğŸ”‡ Release
- å‘åå…¼å®¹: ä¿ç•™ processPitch() å’Œ updateExpressiveness() å›é€€é€»è¾‘

**éªŒè¯æ–‡æ¡£**: `PHASE2.7_VERIFICATION.md`
- 4 ä¸ªæ ¸å¿ƒæ˜ å°„çš„å®ç°é€»è¾‘
- 6 ä¸ªæµ‹è¯•åœºæ™¯ (ç¨³å®šéŸ³/é¢¤éŸ³/æ˜äº®/ä½æ²‰/æ°”å£°/æ–­éŸ³)
- å®Œæ•´çš„æµè§ˆå™¨éªŒè¯æ­¥éª¤

**æµè§ˆå™¨æµ‹è¯•**: â³ å¾…ç”¨æˆ·éªŒè¯
- éªŒè¯æ–¹æ³•: æ‰“å¼€ http://localhost:50656ï¼ŒæŒ‰ç…§ PHASE2.7_VERIFICATION.md æµ‹è¯•
- é¢„æœŸ: éŸ³è‰²éšè¡¨ç°åŠ›ç‰¹å¾æ˜æ˜¾å˜åŒ–

**äº¤ä»˜ç‰©è¯„ä¼°**: âœ… å®ç°å®Œæˆï¼Œå¾…æµè§ˆå™¨éªŒè¯

---

### Phase 2.8-2.10: Legacy Synthesizer + Worklet + UI - å¾…å¼€å§‹

**çŠ¶æ€**: â³ å¾…å¼€å§‹

---

## ğŸ“Š æ•´ä½“è¿›åº¦

```
Phase 2.1  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ…
Phase 2.2  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ…
Phase 2.3  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ…
Phase 2.4  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ…
Phase 2.4è¡¥å…… â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ…
Phase 2.5  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ…
Phase 2.5è¡¥ä¸ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ…
Phase 2.6  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ…
Phase 2.7  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%  âœ… (å¾…æµè§ˆå™¨éªŒè¯)
Phase 2.8  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%  â³
Phase 2.9  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%  â³
Phase 2.10 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%  â³

æ€»ä½“è¿›åº¦: 78% (8/10 æ ¸å¿ƒé˜¶æ®µå®Œæˆï¼Œå« 1 è¡¥ä¸)
```

### å·²å®Œæˆæ¨¡å—æ±‡æ€»

| é˜¶æ®µ | æ¨¡å— | ä»£ç è¡Œæ•° | æµ‹è¯•è¡Œæ•° | æ–­è¨€æ•° | çŠ¶æ€ |
|------|------|---------|---------|--------|------|
| 2.3 | SmoothingFilters | 418 | 455 | 39 | âœ… |
| 2.4 | OnsetDetector | 345 | 482 | 34 | âœ… |
| 2.4è¡¥å…… | AudioUtils | 317 | 436 | 67 | âœ… |
| 2.5 | SpectralFeatures | 317 | 414 | 58 | âœ… |
| 2.6 | ExpressiveFeatures | 311 | 472 | 52 | âœ… |
| 2.7 | ContinuousSynth é€‚é… | ~150 | - | - | âœ… (å¾…éªŒè¯) |
| **åˆè®¡** | **6 ä¸ªæ¨¡å—** | **~1858** | **2259** | **250** | âœ… |

---

## ğŸ“ˆ è´¨é‡æŒ‡æ ‡

### ä»£ç è´¨é‡
- âœ… **å¯ç»´æŠ¤æ€§**: â˜…â˜…â˜…â˜…â˜… (æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£æ¸…æ™°)
- âœ… **å¯éªŒè¯æ€§**: â˜…â˜…â˜…â˜…â˜… (100% æµ‹è¯•é€šè¿‡ï¼ŒçœŸæ­£ä¼šå¤±è´¥çš„æµ‹è¯•æ¡†æ¶)
- âœ… **å¯æ‰©å±•æ€§**: â˜…â˜…â˜…â˜…â˜… (å·¥å‚æ¨¡å¼ï¼Œæ˜“äºæ·»åŠ æ–°æ»¤æ³¢å™¨)

### æµ‹è¯•è´¨é‡
- âœ… **è¦†ç›–ç‡**: 100% (å·²å®ç°æ¨¡å—)
- âœ… **æ–­è¨€æ•°é‡**: 140 ä¸ª
- âœ… **å¤±è´¥æ£€æµ‹**: èƒ½å¤Ÿæ­£ç¡®æ£€æµ‹å¤±è´¥
- âœ… **æ€§èƒ½éªŒè¯**: æ‰€æœ‰å‡½æ•°æ€§èƒ½åˆæ ¼

### æ–‡æ¡£è´¨é‡
- âœ… **è§„æ ¼è¯´æ˜**: å®Œæ•´ä¸”è¯¦ç»†
- âœ… **API æ–‡æ¡£**: JSDoc + ä¸­æ–‡æ³¨é‡Š
- âœ… **è®¾è®¡æ–‡æ¡£**: æ¸…æ™°çš„æ¶æ„è®¾è®¡

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³ä»»åŠ¡**: Phase 2.7 æµè§ˆå™¨éªŒè¯
   - æ‰“å¼€ http://localhost:50656
   - æŒ‰ç…§ PHASE2.7_VERIFICATION.md è¿›è¡Œ 6 ä¸ªæµ‹è¯•åœºæ™¯
   - è®°å½•å®é™…è¡¨ç° (æ—¥å¿—æˆªå›¾ã€éŸ³è‰²æè¿°)
   - å¦‚æœ‰é—®é¢˜ï¼Œè°ƒæ•´å‚æ•°å¹¶é‡æ–°æµ‹è¯•

2. **çŸ­æœŸç›®æ ‡**: Phase 2.8 Legacy Synthesizer é€‚é…
   - æ–‡ä»¶: js/synthesizer.js
   - æ˜ å°„: volumeDb â†’ velocity, brightness â†’ filter, cents â†’ detune, articulation â†’ note on/off

3. **ä¸­æœŸç›®æ ‡**: Phase 2.9 Worklet è·¯å¾„æ¢å¤
   - ç ”ç©¶ buffer ä¼ é€’æ–¹æ¡ˆ (postMessage vs SharedArrayBuffer)
   - å¯ç”¨ useWorklet: true
   - æ¢å¤ 8-15ms ä½å»¶è¿Ÿ

4. **é•¿æœŸç›®æ ‡**: Phase 2.10 æµ‹è¯•åŸºç¡€è®¾æ–½
   - æ·»åŠ  npm test è„šæœ¬
   - åˆ›å»º run-all-tests.js
   - CI/CD å‡†å¤‡

---

## ğŸ” ç»éªŒæ•™è®­

### å·²ä¿®æ­£é—®é¢˜

1. **æµ‹è¯•æ¡†æ¶é—®é¢˜**:
   - âŒ åˆå§‹ä½¿ç”¨ `console.assert()`ï¼Œå¤±è´¥æ—¶ä¸ä¸­æ–­
   - âœ… ä¿®æ­£ä¸ºè‡ªå®šä¹‰ `assert()`ï¼Œå¤±è´¥æ—¶æŠ›å‡º Error
   - **æ•™è®­**: å¿…é¡»ä½¿ç”¨çœŸæ­£ä¼šå¤±è´¥çš„æµ‹è¯•æ¡†æ¶

2. **æäº¤ä¿¡æ¯å‡†ç¡®æ€§**:
   - âŒ åˆå§‹æäº¤ä¿¡æ¯è¡Œæ•°ä¸å‡†ç¡®
   - âœ… ç°åœ¨ä½¿ç”¨å®é™…è¡Œæ•°
   - **æ•™è®­**: æäº¤å‰å¿…é¡»éªŒè¯æ‰€æœ‰æ•°æ®

3. **æµ‹è¯•é€»è¾‘æ­£ç¡®æ€§**:
   - âŒ æµ‹è¯•é€»è¾‘é”™è¯¯å¯¼è‡´å¤±è´¥è¢«å¿½ç•¥
   - âœ… ä¿®æ­£æµ‹è¯•é€»è¾‘ä½¿å…¶çœŸæ­£éªŒè¯åŠŸèƒ½
   - **æ•™è®­**: æµ‹è¯•å¿…é¡»éªŒè¯æ­£ç¡®çš„è¡Œä¸º

### ä¿æŒçš„ä¼˜ç‚¹

1. âœ… **æ–‡æ¡£ä¼˜å…ˆ**: å…ˆå†™è§„æ ¼å†å†™ä»£ç 
2. âœ… **æµ‹è¯•é©±åŠ¨**: æ¯ä¸ªæ¨¡å—éƒ½æœ‰å®Œæ•´æµ‹è¯•
3. âœ… **å°æ­¥æäº¤**: æ¯ä¸ªé˜¶æ®µç‹¬ç«‹æäº¤
4. âœ… **ä»£ç è´¨é‡**: ä¸¥æ ¼éµå¾ªæœ€ä½³å®è·µ

---

**æœ€åæ›´æ–°**: 2025-10-31
**å½“å‰åˆ†æ”¯**: working-1
**æœ€æ–°æäº¤**: Phase 2.7 å®Œæˆ (commit 4e2e83c)
